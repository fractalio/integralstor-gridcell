{% extends 'dashboard_base.html' %}

{%block tab_header%}
  Integralstor GRIDCell Dashboard
{%endblock%}

{%block inside_content%}
{%load utilities%}
<br><br>
<div class="row margin-left-1">
  <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
    <div class="box ">
      <div class="box-header">
          <h3 class="box-title">GRIDCell Status</h3>
          <div class="box-tools pull-right">
              <button data-original-title="Collapse" class="btn btn-default btn-sm" data-widget="collapse" data-toggle="tooltip" title=""><i class="fa fa-minus"></i></button>
          </div>
      </div>
      <div class="box-body">
        <br />
        <br />
          <table class="table ">
            <tr>
              <td>Total number of GRIDCells</td>
              <td>{{nodes|length}}</td>
            </tr>
            <tr>
              <td {%if num_nodes_bad > 0 %}style="color:red"{%endif%}>Number of degraded GRIDCells</td>
              <td {%if num_nodes_bad > 0 %}style="color:red"{%endif%}>{{num_nodes_bad}}</td>
            </tr>
            {%if num_nodes_bad %}
            <tr>
              <td style="color:red">Degraded GRIDCells</td>
              <td style="color:red">{{bad_nodes|join:","}}</td>
            </tr>
            {%endif%}
            <tr>
              <td>Number of GRIDCells in the storage pool</td>
              <td>{{total_pool}}</td>
            </tr>
            <tr>
              <td {%if num_pools_bad > 0 %}style="color:red"{%endif%}>Number of GRIDCells with storage pool issues</td>
              <td {%if num_pools_bad > 0 %}style="color:red"{%endif%}>{{num_pools_bad}}</td>
            </tr>
            {%if num_pools_bad %}
            <tr>
              <td style="color:red">GRIDCells with storage pool issues</td>
              <td style="color:red">{{bad_node_pools|join:","}}</td>
            </tr>
            {%endif%}
            <tr>
              <td>Number of GRIDCells with clustered CIFS access</td>
              <td>{{num_ctdb_nodes}}</td>
            </tr>
            <tr>
              <td {%if num_bad_ctdb_nodes > 0 %}style="color:red"{%endif%}>Number of GRIDCells with clustered CIFS access issues</td>
              <td {%if num_bad_ctdb_nodes > 0 %}style="color:red"{%endif%}>{{num_bad_ctdb_nodes}}</td>
            </tr>
            {%if num_bad_ctdb_nodes > 0 %}
            <tr>
              <td style="color:red">GRIDCells with clustered CIFS access issues</td>
              <td style="color:red">
                {%for t in bad_ctdb_nodes %}
                {{t.0}}({{t.1}}), 
                {%endfor%}
              </td>
            </tr>
            {%endif%}
          </table>
        </p>
      </div><!-- /.box-body -->
      <div class="box-footer">
        <span class="pull-right">
          <a href="/show/gridcells" role="button" {%if num_nodes_bad > 0 %}class="btn btn-warning">More Details <i class="fa fa-bell-o"></i> {%else%}class="btn btn-success">More Details <i class="fa fa-arrow-right"></i>{%endif%} </a>
        </span>
      </div><!-- /.box-footer-->
    </div>
  </div>

  <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
    <div class="box">
      <div class="box-header">
          <h3 class="box-title">Shares and Targets Information</h3>
          <div class="box-tools pull-right">
              <button data-original-title="Collapse" class="btn btn-default btn-sm" data-widget="collapse" data-toggle="tooltip" title=""><i class="fa fa-minus"></i></button>
          </div>
      </div>
      <div class="box-body">
          <table class="table ">
            <tr>
              <td>Total number of CIFS shares</td>
              <td>{{num_shares}}</td>
            </tr>
            <tr>
              <td>Total number of ISCSI targets</td>
              <td>{{num_targets}}</td>
            </tr>
          </table>
      </div><!-- /.box-body -->
      <div class="box-footer">
        <span class="pull-right">
          <a href="/show/display_shares" role="button" class="btn btn-success">More Details <i class="fa fa-arrow-right"></i> </a>
        </span>
      </div><!-- /.box-footer-->
    </div>
  </div>
  <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
    <div class="box">
      <div class="box-header">
          <h3 class="box-title">Volume Status</h3>
          <div class="box-tools pull-right">
              <button data-original-title="Collapse" class="btn btn-default btn-sm" data-widget="collapse" data-toggle="tooltip" title=""><i class="fa fa-minus"></i></button>
          </div>
      </div>
      <div class="box-body">
          <table class="table ">
            <tr>
              <td>Total number of volumes</td>
              <td>{{volume_info_list|length}}</td>
            </tr>
            <tr>
              <td {%if num_vols_bad > 0 %}style="color:red"{%endif%}>Number of degraded volumes</td>
              <td {%if num_vols_bad > 0 %}style="color:red"{%endif%}>{{num_vols_bad}}</td>
            </tr>
            {%if num_volumes_bad %}
            <tr>
              <td style="color:red">Degraded volumes</td>
              <td style="color:red">{{bad_volumes|join:","}}</td>
            </tr>
            {%endif%}
            <tr>
              <td {%if num_quotas_exceeded > 0 %}style="color:red"{%endif%}>Number of volumes exceeding quotas</td>
              <td {%if num_quotas_exceeded > 0 %}style="color:red"{%endif%}>{{num_quotas_exceeded}}</td>
            </tr>
            {%if num_quotas_exceeded %}
            <tr>
              <td style="color:red">Volumes exceeding quotas</td>
              <td style="color:red">{{quota_exceeded_vols|join:","}}</td>
            </tr>
            {%endif%}
          </table>
      </div><!-- /.box-body -->
      <div class="box-footer">
        <span class="pull-right">
          <a href="/show/volume_info_all" role="button" {%if num_vols_bad > 0 %}class="btn btn-warning">More Details<i class="fa fa-bell-o"></i> {%else%}class="btn btn-success">More Details <i class="fa fa-arrow-right"></i>{%endif%} </a>
        </span>
      </div><!-- /.box-footer-->
    </div>
  </div>
</div>
<script type="text/javascript" src="/static/js/jquery.easypiechart.min.js"></script>
<link rel="stylesheet"type="text/css" href="/static/css/jquery.easy-pie-chart.css">

<script type="text/javascript">
$(function() {
    $('.chart').easyPieChart({
      barColor : function(percent){
                        if (percent <= 50)
                          return '#008D4C'
                        else if (percent >50 && percent <= 75)
                          return '#F39C12'
                        else
                          return '#F56954'
                      },
      lineCap : 'round',
      lineWidth : 2,
      trackColor: '#eee',
      animate : true,
      size : 100,
    });
});
</script>
{%endblock%}
{%block help_header%}
Dashboard
{%endblock%}
{%block help_body%}
<p>The IntegralView dashboard is a one stop page that gives you an overall view of the status and health of the IntegralStor system. From this page, you can get an idea of the health of each GRIDCell, the storage pool and of all the data volumes.</p>
{%endblock%}

{% block menu_active %}
<script>
  make_side_menu_active("dashboard_menu")
</script>
{% endblock%}
