
{% extends 'volume_base.html' %}


{%block tab_header%}
  Volume details
{%endblock%}
{%block inside_content %}
  <br><br>
  {% load utilities %}

  <div class="row">
    <div class="col-md-12 col-sm-12 col-lg-12">
      <div class="box box-info box-solid collapsed-box">
        <div class="box-header with-border">
          <h3 class="box-title">Basic Information</h3>
          <div class="box-tools pull-right">
            <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-plus"></i></button>
          </div><!-- /.box-tools -->
        </div><!-- /.box-header -->
        <div style="display: none;" class="box-body">
           <table class="table table-bordered">
             <tr>
               <td>
                 Name
               </td>
               <td>
                  {{vol.name}}
               </td>
             </tr>
             <tr>
               <td>
                  Type
               </td>
               <td>
                 {{vol.type}}
               </td>
             </tr>
             <tr>
               <td>
                  Access mode
               </td>
               <td>
                  {% if iscsi %} ISCSI block access {%else %} NFS/CIFS file access {%endif%} 
               </td>
             </tr>
             <tr>
               <td>
                   Number of Data locations used
               </td>
               <td>
                  {{vol.brick_count}} 
               </td>
             </tr>
             <tr>
               {% if replicate %} 
                 <td>
                    Data replicated across
                 </td>
                 <td>
                   <span class="pull-right "> {{vol.replica_count}} GRIDCell{% if vol.replica_count != '1' %}'s {%endif%} </span>
                 </td>
               {% elif distribute %}
                 <td>
                    Data distributed across
                 </td>
                 <td>
                    {{vol.brick_count}} GRIDCell{% if vol.brick_count != '1' %}'s {%endif%} 
               </td>
             {%endif%}
             </tr>
             <tr>
               <td>
                Data locations
               </td>
               <td>
                  {%if vol.bricks  %}
                    {%for br_list in vol.bricks%}
                      {%for br in br_list%}
                        {{br}}<br>
                      {%endfor%}
                    {%endfor%}
                 {%endif%}
               </td>
             </tr>
            {% if vol.options %}
             <tr>
               <td>
                  Extra Options:
               </td>
               <td>
              <ol>
            {%for o in vol.options%}
              {% if o.name == "auth.reject" %}
                <span > Disallowed hosts (all access methods) : {{o.value}}</span>
              {% elif o.name == "auth.allow" %}
                <span > Permitted hosts (all access methods) : {{o.value}}</span>
              {% elif o.name == "nfs.rpc-auth-reject" %}
                <span >Disallowed hosts (NFS only) : {{o.value}}</span>
              {% elif o.name == "nfs.rpc-auth-allow" %}
                <span >Permitted hosts (NFS only) : {{o.value}}</span>
              {%else%}
               <li>{{o.name}}::{{o.value}}</li>
              {%endif%}
            {%endfor%}
              </ol>
               </td>
             </tr>
           {%endif%}
           </table>
        </div><!-- /.box-body -->
      </div>
    </div>
    <div class="col-md-12 col-sm-12 col-lg-12">
      <div class="box box-info box-solid collapsed-box">
        <div class="box-header with-border">
          <h3 class="box-title">Space Utilization</h3>
          <div class="box-tools pull-right">
            <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-plus"></i></button>
          </div><!-- /.box-tools -->
        </div><!-- /.box-header -->
        <div style="display: none;" class="box-body">
          <ul class="nav nav-stacked">
            <li>
                <a href="#"> Volume size used Percentage
                  <span class="progress-bar {% if vol.size_used_percent >= 80 %} progress-bar-danger {%endif%}"> </span>
                  <span class="pull-right ">{{vol.size_used_percent}}% used</span>
                </a>
            </li>
            <li>
                <a href="#"> Total usable capacity
                  <span class="pull-right "> {{vol.size_total}} </span>
                </a>
            </li>
            <li>
                <a href="#"> Space Used
                  <span class="pull-right "> {{vol.size_used}} </span>
                </a>
            </li>
            <li>
                <a href="#"> Space Free
                  <span class="pull-right "> {{vol.size_free}} </span>
                </a>
            </li>
          </ul>
        </div><!-- /.box-body -->
      </div>
    </div>
    
    <div class="col-md-12 col-sm-12 col-lg-12">
      <div class="box box-info box-solid collapsed-box">
        <div class="box-header with-border">
          <h3 class="box-title">Quota Information</h3>
          <div class="box-tools pull-right">
            <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-plus"></i></button>
          </div><!-- /.box-tools -->
        </div><!-- /.box-header -->
        <div style="display: none;" class="box-body">
          <b>Quota enabled :</b> {%if quota_enabled%} Yes {%else%} No {%endif%} &nbsp;&nbsp;
          {%if quota_enabled%}
            <a href="/change_quota_status?vol_name={{vol.name}}&action=disable" role="button" class="btn btn-primary btn-xs"> Disable quotas </a>
          {%else%}
            <a href="/change_quota_status?vol_name={{vol.name}}&action=enable" role="button" class="btn btn-primary btn-xs"> Enable quotas </a>
          {%endif%}
          <br><br>
          {% if vol.quotas %}
            <table class="table">          
              <tr>
                <th> Directory </th>
                <th> Hard limit </th>
                <th> Soft limit </th>
                <th> Used </th>
                <th> Available </th>
                <th> Soft limit exceeded </th>
                <th> Hard limit exceeded </th>
                <th> &nbsp;</th>
                <th> &nbsp;</th>
              </tr>
              {%for dir, quota in vol.quotas.items%}
                {% if quota.soft_limit_exceeded == 'Yes' %}
                  <tr class="warning">
                {% elif quota.hard_limit_exceeded == 'Yes' %}
                  <tr class="danger">
                {%else%}
                  <tr>
                {%endif%}
                    <td> {{dir}} </td>
                    <td> {{quota.limit}} </td>
                    <td> {{quota.soft_limit}} </td>
                    <td> {{quota.size}} </td>
                    <td> {{quota.available}} </td>
                    <td> {{quota.soft_limit_exceeded}} </td>
                    <td> {{quota.hard_limit_exceeded}} </td>
                    <td> <a href="/set_dir_quota?vol_name={{vol.name}}&dir={{dir}}" role="button" class="btn btn-primary btn-xs"> Modify </a> </td>
                    <td> <a href="/remove_dir_quota?vol_name={{vol.name}}&dir={{dir}}" role="button" class="btn btn-danger btn-xs"> Remove </a> </td>
                  </tr>
              {%endfor%}
            </table>          
          {%else%}
            <span class="pull-left"> No directory quotas have been set for this volume.</span>
          {%endif%}
          <br><br>
          {%if quota_enabled%}
            <a href="/set_dir_quota?vol_name={{vol.name}}" role="button" class="btn btn-primary btn-xs"> Add a new directory quota </a>
          {%endif%}
        </div><!-- /.box-body -->
      </div>
    </div>

     
    
   <div class="col-md-12 col-sm-12 col-lg-12">
      <div class="box box-info box-solid collapsed-box">
          <div class="box-header with-border">
            <h3 class="box-title">Overall Volume and Process status in Data Locations</h3>
              <div class="box-tools pull-right">
                <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-plus"></i></button>
              </div><!-- /.box-tools -->
          </div><!-- /.box-header -->
          <div style="display: none;" class="box-body">
            <ul class="nav nav-stacked">
              <li>
                  <a href="#"> Status
                    <span class="pull-right ">{{vol.status_str}}</span>
                  </a>
              </li>
              <li>
                  <a href="#"> Data access status
                    <span class="pull-right ">{{vol.status_str}}, {{vol.data_access_status}}</span>
                 </a>
              </li>
              <li>
                <table class="table table-bordered" style="width:90%">
                  <thead>
                    <tr>
                      <th>
                        Data location
                      </th>
                      <th>
                        Process
                      </th>
                      <th>
                        Status
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    {%for br, st in vol.brick_status.items %}
                      {% if st.self_heal_deamon_status or st.nfs_status %}
                        {%if "replicate" in vol.type.lower %}
                          <tr>
                            <td>
                              {{st.hostname}}
                            </td>
                            <td>
                              Self heal deamon
                            </td>
                            <td>
                              {% if st.self_heal_deamon_status == 1 %} Healthy {%else%} Down {%endif%}
                            </td>
                          </tr>
                        {%endif%}
                        <tr>
                          <td>
                            {{st.hostname}}
                          </td>
                          <td>
                            NFS Server
                          </td>
                          <td>
                            {% if st.nfs_status == 1 %} Healthy {%else%} Down {%endif%}
                          </td>
                        </tr>
                      {%endif%}
                    {%endfor%}
                  </tbody>
                </table>
              </li>
            </ul>
          </div><!-- /.box-body -->
      </div>
    </div>
</div>
  {% if vol.data_access_status_code and vol.data_access_status_code != 0 %}

  <p>The following data locations are having issues :</p>
  <table class="table table-bordered" style="width:70%">
  <tr>
    <th> Problem GRIDCell </th>
    <th> GRIDCell status
  </tr>
  {% for k, v in vol.brick_status.items %}
    {%if vol.brick_status.k.status != 1 %}
    <tr>
      <td>
        {{v.hostname}}
      </td>
      <td>
        <button class="btn btn-warning " onClick="load_node_status('{{v.hostname}}', '{{v.hostname}}');"> Details..</button>
      </td>
    </tr>
    {%endif%}
  {%endfor%}
  </table>
  {%endif%}

  <br>
  <br>
  {%if vol.status == 1 %}
    <div class="btn-group">
      <form action="/volume_specific_op/vol_stop/" method="post">
        <input type=hidden name="vol_name" value="{{vol.name}}">
        <input type=hidden name="op" value="vol_stop">
        <button type="submit" class="btn btn-danger cover-page">Stop this volume</button>
      </form>
    </div>
  {%else %}
    <div class="btn-group">
      <form action="/volume_specific_op/vol_start/" method="post">
        <input type=hidden name="vol_name" value="{{vol.name}}">
        <input type=hidden name="op" value="vol_start">
        <button type="submit" class="btn btn-primary cover-page" >Start this volume</button>
      </form>
    </div>
  {%endif%}
  <div class="btn-group">
    <form action="/volume_specific_op/vol_delete/" method="post">
      <input type=hidden name="vol_name" value="{{vol.name}}">
      <input type=hidden name="op" value="vol_delete">
      <button type="submit" class="btn btn-danger cover-page" {% if vol.status == 1 %} disabled {%endif%}>Delete this volume</button>
    </form>
  </div>
  <div class="btn-group ">
    <form action="/volume_specific_op/expand_volume/" method="post">
      <input type=hidden name="vol_name" value="{{vol.name}}">
      <input type=hidden name="op" value="expand_volume">
      <button type="submit" class="btn btn-primary cover-page" {% if vol.status != 1 %} disabled {%endif%}>Expand this volume</button>
    </form>
  </div>
  <div class="btn-group">
    <form action="/volume_specific_op/vol_options/" method="post">
      <input type=hidden name="vol_name" value="{{vol.name}}">
      <input type=hidden name="op" value="vol_options">
      <button type="submit" class="btn btn-primary cover-page">Change volume options</button>
    </form>
  </div>
  <!--
  <div class="btn-group">
    <form action="/volume_specific_op/vol_quota/" method="post">
      <input type=hidden name="vol_name" value="{{vol.name}}">
      <input type=hidden name="op" value="vol_quota">
      <button type="submit" class="btn btn-primary cover-page" {% if vol.status != 1 %} disabled {%endif%}>Change/set volume quota</button>
    </form>
  </div>
  -->
  {%if distribute %}
  <div class="btn-group">
    <form action="/volume_specific_op/start_rebalance/" method="POST">
      <input type=hidden name="vol_name" value="{{vol.name}}">
      <input type=hidden name="op" value="start_rebalance">
      <button type="submit" class="btn btn-primary cover-page" {% if vol.status != 1 %} disabled {%endif%}>Start volume rebalance</button>
    </form>
  </div>
  {%endif%}
  <br>
  <br>
  <div class="btn-group">
    <a href="/show/volume_info_all/" role="button" class="btn btn-default"> << Back </a>
  </div>

{%endblock%}
{%block help_header%}
  Volume configuration
{%endblock%}
{%block help_body%}
  <p>This page provides details configuration information about the selected data volume including all options that have been set for the volume and its quota, if set.</p>
{%endblock%}
{% block tab_active %}
  <script>
    make_tab_active('volume_configuration_tab')
  </script>
{% endblock %}
