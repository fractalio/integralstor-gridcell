"""Used to load batch operation files

  This exports :
  load_all_files - Loads all the batch files in the batch files dir
  load_specific_file - Loads a specific batch file
"""

import json, os
from integralstor_common import common

def load_all_files():
  """Load the json content of all the batch files from the admin vol's batch dir"""

  list = []
  try:
    batch_dir, err = common.get_batch_files_path()
    if err:
      raise Exception(err)
    if not os.path.exists(batch_dir):
      os.mkdir(batch_dir)
    files = os.listdir(os.path.normpath("%s"%batch_dir))
    if files:
      for file in files:
        d, err = load_specific_file(file)
        if err:
          raise Exception(err)
        list.append(d)
  except Exception, e:
    return None, 'Error loading all batch files : %s'%str(e)
  else:
    return list, None

def load_specific_file(filename):
  """Load the json content of the specified batch file from the admin vol's batch dir

  Return a dict which corresponds to the json in the file

  filename -- The name of the file to process
  """

  # Return the json contents of the filename as the data structure
  d = None
  try:
    batch_dir, err = common.get_batch_files_path()
    if err:
      raise Exception(err)
    f = None
    f = open(os.path.normpath("%s/%s"%(batch_dir, filename)))
    if f:
      d = json.load(f)
  except Exception, e:
    return None, 'Error loading specific batch file : %s'%str(e)
  else:
    return d, None
